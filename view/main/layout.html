<!DOCTYPE html>
<html>
<head>
	<title>新创生</title>
	<meta charset="utf-8" />
	<link rel="shortcut icon" href="../../public/images/favicon.ico" type="image/x-icon" />
	<link rel="stylesheet" type="text/css" href="../../public/css/common.css" />
	<link rel="stylesheet" type="text/css" href="../../public/css/white.css" />
	<link rel="stylesheet" type="text/css" href="../../public/css/mission.css" />
	<link rel="stylesheet" type="text/css" href="../../public/css/index.css" />
	<link rel="stylesheet" type="text/css" href="../../public/css/new_focus.css"/>
	<link rel="stylesheet" type="text/css" href="../../public/css/reviewed.css"/>
	<link rel="stylesheet" type="text/css" href="../../public/css/article.css"/>
	<link rel="stylesheet" type="text/css" href="../../public/css/slicebox.css" />
    <script src="../../public/js/jquery-1.9.1.js"></script>
	<script src="../../public/js/jquery.easing.1.3.js"></script>
	<script src="../../public/js/jquery.scrollify.min.js"></script>
	<script src="../../public/js/index.js"></script>
	<script type="text/javascript" src="../../public/js/modernizr.custom.46884.js"></script>
	<script type="text/javascript" src="../../public/js/jquery.slicebox.js"></script>
</head>
<body>
  <!--头部开始-->

   <div id="head">
     <div class="header_box">
   	   <a href="" class="header_logo"><img src="../../public/images/logo.png"></a>
   	   <ul class="header_right" id="head_ul">
   	  	  <li class="active"><a href="/?num=1">首页</a></li>
   	  	  <li><a href="/white?num=2">小白指栏</a></li>
   	  	  <li><a href="/mission?num=3">任务大厅</a></li>
   	  	  <li><a href="/reviewed">往期踪迹</a></li>
   	  	  <li><a href="/new_focus">最新聚焦</a></li>
   	  	  <li><a href="javascript:void(0)" id="login">登录</a></li>
   	  	  <li><a href="javascript:void(0)" id="register">注册</a></li>
   	   </ul>
   	  </div>
   </div>
   <div class="wrap">
	   <div id="loginBox">
		   <button class="login_close" onclick="loginClose()">
			   <img src="../../public/images/close.png" />
		   </button>
		   <div>
			   <h1>登录<span>还没有帐号?<a href="javascript:void(0)" onclick="reg()">立即注册</a></span></h1>
			   <div class="login_content">
				   <h4 style="font-weight:normal;">手机号或者用户名</h4>
				   <span id="login_user">
					   <input type="text" name="username" placeholder="请输入您的用户名或者手机号" />
				   </span>
				   <span id="login_pwd">
					   <input type="password" name="password" placeholder="请输入您的密码" />
				   </span>
                   <span class="msg"></span>
				   <span><button id="login_btn">登录</button></span>
				   <p>
					   <label>
						   <input type="checkbox" checked="checked" style="vertical-align:middle;" />
						   记住账号
						   <a href="javascript:void(0)" style="float:right;">忘记密码?</a>
					   </label>
				   </p>
			   </div>
		   </div>
	   </div>
	   <div id="registerBox">
		   <button class="login_close" onclick="loginClose()">
			   <img src="../../public/images/close.png" />
		   </button>

			   <h1>注册<span>已经有帐号?<a href="javascript:void(0)" onclick="log()">马上登录</a></span></h1>
			   <div class="reg_content">
				   <h4 style="font-weight:normal;">请用手机号码注册</h4>
				   <span>
					   <input type="text" name="username" placeholder="手机号" />
				   </span>
				   <span>
					   <input type="password" name="password" placeholder="密码" />
				   </span>
				   <span>
					   <input type="password" name="repassword" placeholder="确认密码" />
				   </span>
				   <span id="register_identify">
					   <input type="text" name="verify" placeholder="短信验证码" />
					   <button id="verify_btn" class="phoneCode" onclick="sendMessage()">获取验证码</button>
				   </span>
				   <span id="msg"></span>
				   <p>
					   <label>
						   <input type="checkbox" checked="checked" style="vertical-align:middle;" />
						   已经阅读并同意
						   <a href="javascript:void(0)">《新创生注册协议》</a>
					   </label>
				   </p>
				   <span><button id="register_btn">注册</button></span>
			   </div>

	   </div>
   </div>
   <div id="loginMask"></div>

   <!--头部结束-->

  <div class="container-fluid">
	  <!--模板引擎的静态块-->
	  {%block main%}{%endblock%}
  </div>

   <!--底部开始-->
   <div id="bot">
    <div class="foot_box">
   	  <div class="link">
   	    <div class="link_box">
   	  	<a>友情链接</a>
   	  	<a href="http://www.baidu.com" >百度</a>
   	  	<a href="http://www.jd.com">京东</a>
   	  	 </div>
   	  </div>
   	  <div class="foot">
   	  	 <div class="foot_info">
   	  	 	<div class="foot_info_left">
   	  	 		<div class="f_about_company">
   	  	 			<p>关于公司</p>
   	  	 			<p>
   	  	 			   <a href="" ><img src="../../public/images/qqtp.png" title="新生交流群1" /></a>
   	  	 			   <a href="" ><img src="../../public/images/group.png" title="新生交流群2" /></a>
   	  	 			   <a href="" class="jt" >商务洽谈</a>
   	  	 			</p>
   	  	 			<div class="f_button_share">
   	  	 				<a href="" class="share_qq" title="分享到qq好友"></a>
   	  	 				<a href="" class="share_txwb" title="分享到腾讯微博"></a>
   	  	 				<a href="" class="share_weix" title="分享到微信"></a>
   	  	 				<a href="" class="share_txweb" title="分享到新浪微博"></a>
   	  	 			</div>
   	  	 		</div>
   	  	 		<div class="f_contact_us">
   	  	 			  <ul>
   	  	 			  	 <li>
   	  	 			  	 	<p>联系电话：</p>
   	  	 			  	 	<p style="font-size:17px">023-813888888 023-35489686665 023-354896865467</p>
   	  	 			  	 </li>
   	  	 			  	 <li>
   	  	 			  	 	<p>地址：</p>
   	  	 			  	 	<p>重庆市双福新区</p>
   	  	 			  	 </li>
   	  	 			  </ul>
   	  	 		</div>
   	  	 		<div class="clear"></div>
   	  	 	</div>
   	  	 	<div class="foot_info_right">
   	  	 	  <div class="foot_info_code">
   	  	 		<div class="info_code_box">
   	  	 			<img src="../../public/images/1474861508.jpg" width="76" height="76" />
   	  	 		</div>
   	  	 		<p>新创生官方二维码</p>
   	  	 	  </div>
   	  	 	</div>
   	  	 	<div class="clear"></div>
   	  	 </div>
   	  </div>
   	  <div class="footer_copy">
   	  	 <div class="footer_copy_box">版权所有©新创生MUX,powered by alimama THX.</div>
   	  </div>
   	</div>
   </div>
   <!--底部结束-->
   <script>
		$(function(){
			$("#login").click(function(){
				$("#loginMask").fadeIn();
				$("#loginBox").fadeIn();
				$("#loginBox").animate({
					top:"0px"
				},1000);
			});
			$("#register").click(function(){
				$("#loginMask").fadeIn();
				$("#registerBox").fadeIn();
				$("#registerBox").animate({
					top:"0px"
				},1000);
			});

			//注册
			$("#register_btn").on("click",function () {
				var uname=$("#registerBox").find("[name='username']").val();
				var pwd=$("#registerBox").find("[name='password']").val();
				var repwd=$("#registerBox").find("[name='repassword']").val();
                var verifyCode=$("#registerBox").find("[name='verify']").val();
				var msg=$("#msg");
				if(uname=="" || uname==null || pwd=="" || pwd==null || repwd=="" || repwd==null){
                    msg.show();
                    msg.html("手机号或者密码不能为空！");
                    setTimeout(function(){
                       msg.hide();
                    },3000);
                    return;
				}
                var phoneNumber=/^1[34578]\d{9}$/;
                if(!phoneNumber.test(uname)){
                    //手机号码格式不正确，请重新输入！
                    msg.show();
                    msg.html("手机号码格式不正确，请重新输入！");
                    setTimeout(function(){
                        msg.hide();
                    },3000);
                    return;
                }
				if(pwd!==repwd){
                    msg.show();
                    msg.html("两次输入的密码不一致，请重新输入！");
                    setTimeout(function(){
                        msg.hide();
                    },3000);
                    return;
				}
				//验证码
                var InterValObj; //timer变量，控制时间
                var count = 60; //间隔函数，1秒执行
                var curCount;//当前剩余秒数
                var APP_ID = '9U5NuUnEAgCyomWXjkEjLRa1-gzGzoHsz';
                var APP_KEY = '8VrlzHpHOg1ABSosSKb2hw2x';
                AV.init({
                    appId:APP_ID,
                    appKey:APP_KEY
                });

                function sendMessage(){
                    curCount = count;
                    //设置button效果，开始计时
                    $("#verify_btn").attr("disabled", "true");
                    $("#verify_btn").val( curCount + "s");
                    InterValObj = setInterval(SetRemainTime, 1000); //启动计时器，1秒执行一次

                    var user = new AV.User();
                    user.set("username", uname);
                    user.set("password", pwd);
                    user.setMobilePhoneNumber(uname+"");

                    user.signUp(null);
                }
                //timer处理函数
                function SetRemainTime() {
                    if (curCount == 0) {
                        window.clearInterval(InterValObj);//停止计时器
                        $("#verify_btn").removeAttr("disabled");//启用按钮
                        $("#verify_btn").val("重发验证码");
                    }
                    else {
                        curCount--;
                        $("#verify_btn").val( curCount + "s" );
                    }
                }
                //验证码
                function verify(){
                    var num=parseInt( verifyCode );
                    AV.User.verifyMobilePhone(num).then(function(){
                        //验证成功
                        //alert("验证成功");
                    }, function(err){
                        //验证失败
                        //console.log(err);
                        msg.show();
                        msg.html("验证码错误！");
                        setTimeout(function(){
                            msg.hide();
                        },3000);
                    });
                }
				$.ajax({
					type:"post",
					url:"/api/user/register",
					data:{
						uname:uname,
						pwd:pwd
					},
					dataType:"json",
					success:function (data) {
						if(data.code!=2){
                            msg.show();
                            msg.html(data.msg);
                            setTimeout(function(){
                                msg.hide();
                            },3000);
						}else{
                            //注册成功，显示登陆界面
                            msg.show();
                            msg.html(data.msg);
                            setTimeout(function(){
                                msg.hide();
                                $("#registerBox").find("[name='username']").val("");
                                $("#registerBox").find("[name='password']").val("");
                                $("#registerBox").find("[name='repassword']").val("");
                                log();
                            },3000);
						}
					}
				});
			});
		});

	   function loginClose(){
		   $("#loginMask").fadeOut();
		  //$("#loginBox").fadeOut();
		   $("#loginBox").animate({
			   top:"-600px"
		   },1000);
		   $("#registerBox").animate({
			   top:"-600px"
		   },1000);
		}
		function reg(){
            $("#loginBox").animate({
                top:"-600px"
            },1000,function(){
                $("#loginMask").fadeIn();
                $("#registerBox").fadeIn();
                $("#registerBox").animate({
                    top:"0px"
                });
            });
        }
        function log(){
            $("#registerBox").animate({
                top:"-600px"
            },1000,function(){
                $("#loginMask").fadeIn();
                $("#loginBox").fadeIn();
                $("#loginBox").animate({
                    top:"0px"
                });
            });
        }

   </script>
</body>
</html>